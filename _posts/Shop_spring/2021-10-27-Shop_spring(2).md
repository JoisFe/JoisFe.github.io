---
title: "도메인 분석 설계"
categories:
  - Project - Shop_spring
tags:
  - 스프링 부트
  - thymeleaf
use_math: true
---

이번에는 도메인을 분석 설계 해보려고 한다.

# 도메인 분석 설계

## 요구사항 분석
먼저 구현하고자 하는 실제 동작하는 화면은 아래와 같다.
![png](/images/Shop_spring(2)_files/실제동작화면.png) 
<br>

구체적으로 구현해야할 기능들에 대해 알아보자 <br>

### 기능 목록
- 회원 기능
    - 회원 등록
    - 회원 조회
- 상품 기능
    - 상품 등록
    - 상품 수정
    - 상품 조회
- 주문 기능
    - 상품 주문
    - 주문 내역 조회
    - 주문 취소
- 기타 요구사항
    - 상품은 재고 관리가 필요하다.
    - 상품의 종류는 도서, 음반, 영화가 있다.
    - 상품을 카테고리로 구분할 수 있다.
    - 상품 주문시 배송 정보를 입력할 수 있다.

## 도메인 모델과 테이블 설계

먼저 도메인 모델부터 구상해보자 <br>
![png](/images/Shop_spring(2)_files/도메인 모델.png) 
<br>

회원, 주문, 상품의 관계 : <br>
회원은 여러 상품을 주문할 수 있고 한 번 주문할 때 여러 상품을 선택할 수 있기 때문에 주문과 상품이 다대다 관계이다. <br>
그러나 다대다 관계는 관계형 데이터베이스와 엔티티에서 거의 사용하지 않기 때문에 그림처럼 주문상품이라는 엔티티를 추가해서 다대다 관계를 일대다, 다대일 관계로 풀어내는 것이 좋다. <br>
<br>

상품 분류 : <br>
상품은 도서, 음반, 영화로 구분된다. <br>
상품이라는 공통 속성을 사용하기 때문에 상속 구조로 나타내었다. <br>
<br>

### 회원 엔티티 분석
![png](/images/Shop_spring(2)_files/회원엔티티분석.png) <br>

회원(Member) : <br>
이름과 임베디드 타입인 주소(Address), 주문(orders) 리스트를 가짐
<br> <br>

주문(Order) : <br>
한 번 주문시 여러 상품을 주문할 수 있기 때문에 주문과 주문상품(OrderItem)은 일대다 관계가 된다. <br>
주문은 상품을 주문한 회원, 배송 정보, 주문 날짜, 주문 상태(status)를 가지고 있다. <br>
주문 상태는 열거형을 사용했고 주문(ORDER)과 취소(CANCEL)을 표현 가능하다. <br>
<br>

주문상품(OrderItem) : <br>
주문한 상품 정보와 주문 금액(orderPrice), 주문 수량(count) 정보를 가지고 있다.<br>
(보통 OrderLine, LineItem으로 많이 표현한다고 한다.) <br>
<br>

상품(Item) : <br>
이름, 가격, 재고수량(stockQuantity)을 가지고 있다. <br>
상품을 주문하면 재고수량이 줄어든다. <br>
상품의 종류는 도서, 음반, 영화가 있고 각각은 사용하는 속성이 조금씩은 다르다. <br>
<br>

배송(Delivery) : <br>
주문시 하나의 배송 정보를 생성한다.<br>
주문과 배송은 일대일 관계이다. <br>
<br>

카테고리(Category) : <br>
상품과 다대다 관계를 맺는다. <br>
parent, child로 부모, 자식 카테고리를 연결한다. <br>
<br>

주소(Address) : <br>
값 타입(임베디드 타입) 이다. <br>
회원과 배송(Delivery)에서 사용한다. <br>
<br>

회원이 주문을 하기 때문에 회원이 주문리스트를 가지는 것이 잘 설계한 것 같지만 객체 세상은 실제 세상과 다르다는 것을 알아야 한다!!! <br>
실무에선 회원이 주문을 참조하지 않고 주문이 회원을 참조하는 것으로 충분하다 <br>
정리하면 회원이 주문을 하니까 회원에 주문의 리스트를 두고 하면 될 것 같지만 이것은 사람의 생각일 뿐이고 시스템은 회원과 주문은 동급으로 놓고 고민해야 한다. <br>
회원을 통해서 항상 주문이 일어나는 것이 아니라 주문을 생성할때 회원이 필요하다고 보는 것이 객체 세상에서는 더 맞다.<br>
<br>

여기서 일대다, 다대일의 양방향 연관관계를 설명하기 위해 추가한 것이다. <br>
<br>

### 회원 테이블 분석
![png](/images/Shop_spring(2)_files/회원테이블분석.png) <br>

MEMBER :
회원 엔티티의 Address 임베디드 타입 정보가 회원 테이블에 그대로 들어갔다. <br>
DELIVERY 테이블도 마찬가지
<br><br>

ITEM :
앨범, 도시, 영화 타입을 통합해서 하나의 테이블로 만듬 <br>
DTYPE 칼럼으로 타입을 구분했다. <br>
<br>

CATEGORY와 ITEM도 다대다 관계인데 이전에 설명 했듯 관계형 데이터베이스와 엔티티에서 거의 사용하지 않기 때문에 그림처럼 CATEGORY_ITEM 테이블을 추가하여 다대다 관계를 일대다, 다대일 관계로 풀어내는 것이 좋다.<br><br>

!! 테이블명이 ORDER이 아니라 ORDERS인 것은 데이터베이스가 order by 때문에 예약어로 잡고 있는 경우가 많기 때문에 관례상 ORDERS를 많이 사용한다고 한다. 참고하자!!!
<br> <br>

실제 코드에서는 DB에 소문자 + _(언더스코어) 스타일을 사용할 것이다. <br>
DB 테이블 명, 칼럼 명에 대한 관례는 사람, 회사마다 다르지만 보통은 대문자 + _나 소문자 + _ 방식 중 하나를 지정하여 일관성 있게 사용한다. <br>
이번 프로젝트에서는 객체와 차이를 나타내기 위해 DB 테이블, 칼럼명은 대문자로 설명하지만 실제 코드에서는 소문자 + _ 스타일을 사용할 것이다. <br><br>

### 엔티티 클래스 개발

이번 프로젝트에서는 엔티티 클래스에 Getter, Setter를 모두 열고 최대한 단순하게 설계를 할 것이다. <br>
하지만 실무에서는 가급적 Getter는 열어두지만 Setter는 꼭 필요한 경우에만 사용하는 것이 좋다고 한다. <br>
<br>

자 이제는 코드로 작성을 해보자

### 회원 엔티티