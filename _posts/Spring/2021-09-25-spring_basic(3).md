---
title: "순수 자바로만 작성하는 예제_주문 할인 도메인 개발"
categories:
  - Spring
tags:
  - 순수 자바 코드로 개발
  - 주문 할인 도메인
  - 실행과 테스트
use_math: true
---

이전에는 회원 도메인 설계를 했다면 이제는 주문 할인 도메인 설계를 해보려 한다.

## 주문 할인 도메인 설계
### 주문 할인 정책
1. 회원은 상품을 주문할 수 있음 <br>
2. 회원의 등급에 따라 할인 정책을 적용할 수 있음 <br>
3. 할인 정책은 모든 VIP 등급의 경우에는 1000원을 할인해주는 고정 금액 할인을 적용하려 한다. (하지만 변경 될 수도 있다.) <br>
4. 할인 정책은 변경 가능성이 높다. 왜냐하면 회사에서 기본 할인 정책을 하직 정하지 못했기 때문이다. 오픈 직전까지 고민을 미루려고 하고, 최악의 경우에는 할인을 적용하지 않을 수도 있다. <br>
<br>

### 주문 도메인 협력, 역할, 책임 관계
![jpeg](/images/Spring_basic(3)_files/주문 도메인 협력, 역할, 책임.jpeg)
<br>

1. 주문 생성 : 클라이언트가 주문 서비스에 주문 생성을 요청 <br>
2. 회원 조회 : 할인을 위해서 회원 등급이 필요하기 때문에 주문 서비슨는 회원 저장소에서 회원을 조회하여 해당 회원의 등급을 알아야 한다. <br>
3. 할인 적용 : 주문 서비스는 해당 회원의 등급을 확인한 후 할인 여부를 할인 정책에 위임한다. <br>
4. 주문 결과 반환 : 주문 서비스는 할인 결과를 포함한 전체 주문에 대한 결과를 클라이언트에게 반환한다. <br> <br>

참고로 실제 주문 데이터는 DB에 저장할 것이다. 하지만 여기 예제에서는 생략하고 단순하게 주문 결과를 반환하는 정도로 구현할 것이다. <br>
<br>

### 주문 도메인 전체
주문 할인 도메인 뿐만 아니라 이전에 구현했던 회원 도메인까지 다 합친 주문 도메인 전체에 대해 나타내면 <br>

![jpeg](/images/Spring_basic(3)_files/주문 도메인 전체.jpeg)
<br>
<br>

### 위 처럼 설계를 하면 역할과 구현을 분리했기 때문에 자유롭게 구현 객체를 조립할 수 있다.
### 따라서 아직 정확히 결정되지 않은 회원 저장소, 할인 정책 또한 유연하게 변경할 수 있다. 

<br><br>
 
### 주문 도메인 클래스 다이어그램
주문 도메인 클래스 다이어그램을 나타내보면 <br>
![jpeg](/images/Spring_basic(3)_files/주문 도메인 클래스 다이어그램.jpeg) 
<br>
<br>

2 가지 객체 다이어그램을 생각해 볼 것이다. <br>
### 주문 도메인 객체 다이어그램1
먼저 첫 번째는 회원 정보를 메모리 회원 저장소에 저장하고, 할인 정책을 정액 할인 정책을 이용하는 경우이다 <br>

![jpeg](/images/Spring_basic(3)_files/주문 도메인 객체 다이어그램1.jpeg) 
<br>
주문 서비스 구현체는 new OrderServiceImpl();을 통해<br>
메모리 회원 저장소는 new MemoryMemerRepository();를 통해<br>
정액 할인 정책은 new FixDiscountPolicy();를 통해<br>
객체를 생성하고자 한다.
<br>
<br>

회원 정보를 메모리 회원 저장소에서 조회하고 정액 할인 정책을 지원해도 주문 서비스를 변경하지 않아도 된다. <br>
역할들의 협력 관계를 그대로 재사용할 수 있다. <br>
만약 메모리를 DB로 바꾼다해도, 정액 할인을 정률 할인으로 바꾼다고 해도 주문 서비스 구현체에도 영향이 없다 <br>
-> 역할과 구현을 분리했기에 가능한 것이다. <br><br>

### 주문 도메인 객체 다이어그램2
주문 도메인 객체 다이어그램1에서 메모리를 DB로, 정액 할인을 정률 할인으로 바꾼 경우이다.
<br>
![jpeg](/images/Spring_basic(3)_files/주문 도메인 객체 다이어그램2.jpeg) 
<br>
이 부분은 아직 정확히 구현은 하지 않고 나중으로 미루겠다.
<br><br>

회원을 메모리가 아닌 실제 DB에서 조회하고 정률 할인 정책을 지원해도 주문 서비스를 변경하지 않아도 된다는 것을 이 객체 다이어그램을 통해 알 수 있다.<br>
즉 협력 관계를 그대로 사용할 수 있다.<br>
<br> 이전에 설명했지만 역할과 구현을 분리했기에 가능한 것이다. <br><br>

# 주문 할인 구조를 기준으로 코드로 작성해보도록 하자. <br>

## 주문과 할인 도메인 개발

### 할인 정책 인터페이스
```java
package hello.spring_basic.discount;

import hello.spring_basic.member.Member;

public interface DiscountPolicy {

    /**
     * @return 할인 대상 금액
     */
    int discount(Member member, int price); //할인 기능 함수 선언

}
```